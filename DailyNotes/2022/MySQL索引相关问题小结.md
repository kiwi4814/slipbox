## 疑问

1. 索引的数据结构是什么？

   对于InnoDB引擎来说，使用B+树索引模型，每个索引对应一颗B+树。

   - **主键索引**，也叫聚簇索引（clustered index），叶子节点存储的是整行数据。

   - **非主键索引**，也叫二级索引（secondary index），叶子节点存储的是主键的值。如果根据二级索引查询，会先根据二级索引找到主键，然后再根据主键查询主键索引找到数据，这个过程被称为回表。

   - **联合索引**：按照第一个字段排序，第一个字段重复的时候按照第二个字段排序，以此类推...

2. 索引的一些原则

   **覆盖索引**：如果要查询的字段已经在某个索引树上了，可以避免掉回表的过程，是常见的性能优化的手段

   **最左前缀原则**：MYSQL做词法分析语法分析的时候是通过建立最左子树来建立语法树的，解析的过程也是从左到右所以遵循最左前缀的原则。这里不仅仅指的是联合索引，也可以是字符串索引的最左边的N个字符，比如 `like 'aaa%'`这种形式。

   **索引下推**：MySQL 5.6 引入的索引下推优化（index condition pushdown)， 可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。

   

3. 普通索引和唯一索引

   不推荐使用过长的ID作为主键（非主键索引也会存储主键，浪费空间）

   - （1）查询 等于 的情况：几乎没有区别，MySQL读取数据以页的形式进行读取，除非刚好在分界点
   - （2）更新：唯一索引因为需要校验唯一性约束，是无法使用change buffer的，所以只有普通索引能用。
   - 对于写多读少的业务来说，尽量使用普通索引，这样能减少随机访问IO的次数，提升效率。

4. MySQL选错索引：

   



## 知识要点

用于提高读写效率的数据结构有很多，常见的有：哈希表、有序数组和搜索树。

**哈希表**：哈希数组+链表，但由于数据无序，做区间查询很慢，适合等值查询的场景（Memcached及其他一些NoSQL引擎）

**有序数组**：按照数据大小的方式保存，查找数据使用二分法，时间复杂度是O(log(N))；但是更新数据成本太高。所以适合静态存储引擎，比如不会再更新的历史数据。

**二叉搜索树**



索引相关篇章：

基础知识：04、05

应用：9、10、11

order by：14、16

join：34、35





### change buffer

更新数据时会先把数据放入change buffer，在下次访问/定期/数据库关闭的时候都会执行merge操作，将数据应用到原数据页。



change buffer 的大小，可以通过参数 innodb_change_buffer_max_size 来动态设置。这个参数设置为 50 的时候，表示 change buffer 的大小最多只能占用 buffer pool 的 50%。





